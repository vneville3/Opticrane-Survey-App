<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="opticrane-icon-192.png" />
  <link rel="manifest" href="manifest.json?v=1.3.2" />
  <title>Opticrane Visual Aid Survey Collection App v1.3.2</title>
  <link rel="stylesheet" href="styles.css?v=1.3.2" />
  <script defer src="app.js?v=1.3.2"></script>
</head>
<body>
<header class="topbar">
  <img class="brand" src="opticrane-icon-192.png" alt="Opticrane logo" />
  <div class="titles">
    <h1>Opticrane Visual Aid Survey <span class="tag">v1.3.2</span></h1>
    <p class="subtitle">Offline-ready. Save drafts, add photos, then share by email.</p>
  </div>
</header>

<main>
  <section class="card">
    <h2>Contact</h2>
    <label>Name
      <input id="contactName" type="text" autocomplete="name" required placeholder="First Last" />
    </label>
    <label>Role or Title
      <select id="role" required>
        <option value="">Select…</option>
        <option>Owner / GM</option>
        <option>Operations Manager</option>
        <option>Site Supervisor</option>
        <option>HSE / CSO</option>
        <option>Fleet / Service</option>
        <option>Operator</option>
        <option>Other</option>
      </select>
    </label>
  </section>

  <section class="card">
    <h2>Site Location</h2>
    <label>Project Name and Address
      <input id="siteCity" type="text" required placeholder="Project Alpha — 123 Main St, Vancouver, BC" />
    </label>
    <label>Environment
      <select id="environment" required>
        <option value="">Select…</option>
        <option>High-rise construction</option>
        <option>Industrial</option>
        <option>Civil / Infrastructure</option>
        <option>Ports / Marine</option>
        <option>Warehouse &amp; MHE</option>
        <option>Other</option>
      </select>
    </label>
  </section>

  <section class="card">
    <h2>Type of Machine</h2>
    <label>Type
      <select id="machine" required>
        <option value="">Select…</option>
        <option>Tower crane</option>
        <option>Luffer</option>
        <option>PTZ (Supervisor Cam)</option>
        <option>Forklift/Telehandler</option>
        <option>Excavator</option>
        <option>Other</option>
      </select>
    </label>
    <label>Proposed Camera Kit
      <input id="targetView" type="text" placeholder="LoadView (AF-Zoom + 7&quot; monitor), FAMOS blind-spot, etc." />
    </label>
  </section>

  <section class="card">
    <h2>Current Issues or Concerns</h2>
    <label>How often is visibility a concern?
      <select id="impactFreq" required>
        <option value="">Select…</option>
        <option>Daily</option>
        <option>Weekly</option>
        <option>Monthly</option>
      </select>
    </label>
    <label>Time lost per shift
      <select id="timeLost" required>
        <option value="">Select…</option>
        <option>&lt; 10 minutes</option>
        <option>10–30 minutes</option>
        <option>30–60 minutes</option>
        <option>&gt; 60 minutes</option>
      </select>
    </label>
  </section>

  <section class="card">
    <h2>Level of Urgency</h2>
    <label>When are cameras needed?
      <select id="timeline" required>
        <option value="">Select…</option>
        <option>ASAP</option>
        <option>This week</option>
        <option>Later, during current project</option>
        <option>On next project (1–3 months)</option>
        <option>Never</option>
      </select>
    </label>
  </section>

  <section class="card">
    <h2>Specific Reason</h2>
    <label>Main reason (choose one)
      <select id="reason" required>
        <option value="">Select…</option>
        <option>Blind Lifts</option>
        <option>Safety (avoid near misses)</option>
        <option>Faster cycles (productivity)</option>
        <option>Better load alignment</option>
        <option>Night / low-light operations</option>
        <option>Weather challenges (rain / fog)</option>
        <option>Operator confidence (new operator)</option>
        <option>GC / client requirement</option>
      </select>
    </label>
    <label>Optional note
      <input id="reasonNote" type="text" placeholder="One-liner (optional)" />
    </label>
  </section>

  <section class="card">
    <h2>Photos (optional)</h2>
    <p>Up to <b>3</b> images. Tap <b>Add photo</b> again to add more. Tap a thumbnail to remove.</p>
    <input id="photos" type="file" accept="image/*" capture="environment" multiple style="display:none" />
    <div class="actions">
      <button id="addPhoto" type="button">Add photo</button>
      <span id="photoCount" class="muted"></span>
    </div>
    <div id="preview" class="preview"></div>
  </section>

  <section class="card">
    <h2>Rep details (optional)</h2>
    <label>Tech initials
      <input id="techInitials" type="text" maxlength="4" placeholder="VN" />
    </label>
  </section>

  <section class="actions">
    <button id="saveDraft" type="button">Save Draft</button>
    <button id="submit" type="button" class="primary">Queue Submission</button>
    <button id="shareLast" type="button" class="ghost">Share Last Entry (Email)</button>
    <button id="composeMailto" type="button" class="ghost">Compose Email (No Attachments)</button>
    <button id="backfill" type="button" class="ghost">Rep Backfill</button>
    <button id="helpBtn" type="button" class="ghost">Help / Info</button>
  </section>

  <section class="card">
    <h2>Settings</h2>
    <p class="helptext">
      <b>Collection email:</b> the address to send entries to (e.g., <code>you@opticrane.com</code>).<br/>
      When you tap <b>Share Last Entry</b>, the app will <b>copy this email to your clipboard</b> so you can just tap <b>To</b> → <b>Paste</b> in Mail. The subject is auto-filled.
    </p>
    <div class="grid">
      <label>Collection email (To)
        <input id="collectionEmail" type="email" placeholder="you@opticrane.com" />
      </label>
      <label>Subject prefix
        <input id="subjectPrefix" type="text" value="Opticrane Survey" />
      </label>
      <label>Rep Backfill form URL
        <input id="backfillUrl" type="url" placeholder="https://forms.microsoft.com/..." />
      </label>
    </div>
    <div class="actions">
      <button id="saveSettings" type="button">Save Settings</button>
      <button id="exportCsv" type="button">Export Queue (CSV)</button>
      <button id="exportJson" type="button">Export Queue (JSON)</button>
      <button id="clearAll" type="button" class="danger">Clear Local Data</button>
    </div>
    <p id="syncStatus" class="statusline"></p>
  </section>

  <div id="helpModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button id="closeHelp" class="close" aria-label="Close">×</button>
      <h2>How this app works</h2>
      <ol>
        <li><b>Queue Submission</b> (works offline).</li>
        <li><b>Share Last Entry</b> → Mail → <em>To</em> (paste; subject auto-filled) → Send.</li>
        <li>Outlook rule moves mail to <b>Survey Inbound</b>; Flow makes the SharePoint item and attaches photos.</li>
        <li><b>Rep Backfill:</b> opens your extra-notes/photos form (set the link in Settings).</li>
      </ol>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
</main>

<footer>
  <p>Opticrane • <a href="https://www.opticrane.com" target="_blank" rel="noopener">opticrane.com</a></p>
</footer>
</body>
</html>

